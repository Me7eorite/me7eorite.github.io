# 第一章、计算机系统概述

- 第一章、计算机层次结构
  - **第一节：计算机系统的组成**
    - **硬件系统和软件系统**
    - 计算机硬件
      - 冯诺依曼基本思想
        - 特点：“存储程序”，把存储程序的思想奠定了现代计算机的基本结构， **以运算器为中心**
          - 1） **采用“存储程序”的工作方式**
          - 2）计算机硬件系统由 **运算器、存储器、控制器、输入和输出设备5大部件**
          - 3）指令和数据以 **同等地位** 存储在存储器中，形式上没有区别，但计算机应能区分它们
          - 4） **指令和数据均以二进制代码标识**
          - 5）指令由 **操作码和地址码** 组成，操作码指出操作的类型，地址码指出操作数的地址
        - 总结：这逼样的程序的基本思想是，把事先写好的程序和数据送入到主存储器后才能执行，然后计算机会自动逐条执行命令，直到跑完
      - 计算机的功能部件
        - **1）输入设备：** 鼠标键盘等等
        - **2）输出设备：** 显示器、打印机， **输入/输出设备（简称I/O设备）**
        - **3）存储器：**
          - 主存储器（RAM）： **也称作内存储器或主存** 。 **CPU能够直接访问**
            - 工作方式： **按地址存取方式** ，按照存储单元的地址进行存取
          - 辅助存储器（ROM）： **也称作外存储器或外存** 。能帮助主存储器记忆更多信息，辅助存储器中的信息必须调入主存储器后才能为CPU访问
          - 主存储器的组成形式 **（《王道书本》P3-4）**
            - **存储体** 存放 **二进制信息**
            - 存储器数据寄存器（MDR，Memory Data Register）用于暂存要从存储器中读或写的信息
            - 存储器地址寄存器（MAR，Memory Address Register）存放访存地址，经过地址译码后找到所选的存储单元。 ![图片](./第一章、计算机系统概述-幕布图片-304297-826788.jpg)
        - **4）运算器**
          - 主要用于 **算数运算** 和 **逻辑运算，算数：加减乘除** 、 **逻辑：与或非异或比较移位**
          - 运算器的核心为： **算术逻辑单元（Arithmetic and Logic Unit，ALU）**
          - 以下是一些寄存器 **（粗体为必备）** ：
            - **1、累加器（ACC）**
            - **2、乘商寄存器（MQ）**
            - **3、操作数寄存器（X）**
            - 4、变址寄存器（IX）
            - 5、基址寄存器（BR）
            - 6、程序状态寄存器也称作标志寄存器（PSW）
            - 运算器的基本构成 ![图片](./第一章、计算机系统概述-幕布图片-411274-15726.jpg)
        - **5）控制器**
          - **计算机的指挥中心** ，由程序技术（PC）、指令寄存器（IR）、控制单元（CU）组成
            - PC存放指令地址
            - IR存放当前指令，内容来源于MDR
            - **详情请查看，王道P4底部**
        - 完整的操作流程可以自适应下面这张图 ![图片](./第一章、计算机系统概述-幕布图片-192944-15586.jpg)
      - CPU的组成，建议参考文章 [CPU基础知识-CPU的组成 运算器、控制器、寄存器 - 流了个火 - 博客园 (cnblogs.com)]("https://www.cnblogs.com/gnivor/p/15679241.html") ![图片](./第一章、计算机系统概述-幕布图片-736842-609150.jpg)
    - 计算机软件
      - 主要分为系统软件和应用软件
      - 三种机器语言的特点
        - 1）机器语言
          - 二进制代码语言， **计算机唯一可以直接识别和执行** ，e.g：0001010010101010100...
        - 2）汇编语言
          - 用英文单词缩写，e.g：LOAD 5\nMUL5...
        - 3）高级语言
          - C语言
        - 翻译程序
          - 1）汇编程序， **汇编到机器语言**
          - 2）解释程序， **将原程序的代码逐条翻译成机器指令**
          - 3）编译程序， **高级语言程序翻译成汇编语言或机器语言**
      - 高级语言程序与机器语言程序的转换
        - 预处理>编译器>汇编器>链接器
      - 计算机体系层次结构 ![图片](./第一章、计算机系统概述-幕布图片-767593-565170.jpg)
  - **第二节：计算机的性能指标**
    - 存储器的性能指标
      - 总容量=
      - 存储单元个数x存储字长bit，1Byte=8bit
      - 存储单元个数x存储字长/8byte
      - e.g. MAR为32位，MDR为8位
      - 总容量=2^32*8bit=4GB
      - 8Byte大小的内存 ![图片](./第一章、计算机系统概述-幕布图片-755671-850067.png)
    - CPU的性能指标
      - **CPU的性能（CPU执行时间）取决于三个要素：主频、CPI和指令条数**
      - CPU主频：CPU内数字脉冲信号震荡的频率
      - CPI（Cycle Per Instruction）：执行一条指令所需要的时钟周期数
      - IPS（Instructions Per Second）：每秒执行多少条指令
      - FLOPS（Floating-point Operations Per Second）：每秒执行多少次浮点运算
      - 几个公式：
        - CPU时钟周期= ​​​​​​​​​​​​​​​​​​​​​​​​​​​​
        - IPS（Instructions Per Second）每秒执行多少条指令= ​​​​​​​​​​​​​​​​​​​​
        - CPI公式： ​​​​​​​​​​​​​​​​​​​​​​​
        - CPU执行时间= ​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​
      - 例题：
        - 题目一 ![图片](./第一章、计算机系统概述-幕布图片-221515-562950.png)
        - 题目二 ![图片](./第一章、计算机系统概述-幕布图片-204956-515549.png)
- 一些有用的TIPS
  - **端序或尾序**
    - 端序或尾序（Endianness），又 称字节顺序。在计算机科学领域中，指电脑内存中或在数字通信链路中，多字节组成的字（Word）的字节（Byte）的排列顺序。字节的排列方式有两个通用规则。例如，将一个多位数的低位放在较小的地址处，高位放在较大的地址处，则称小端序（little-endian）；反之则称大端序（big-endian）。常见的 x86、RISC-V 等架构采用的是小端序。
  - **内存地址对齐**
    - 内存地址对齐是内存中的数据排列，以及 CPU 访问内存数据的方式，包含了基本数据对齐和结构体数据对齐的两部分。CPU 在内存中读写数据是按字节块进行操作，理论上任意类型的变量访问可以从内存的任何地址开始，但在计算机系统中，CPU 访问内存是通过数据总线（决定了每次读取的数据位数）和地址总线（决定了寻址范围）来进行的，基于计算机的物理组成和性能需求，CPU 一般会要求访问内存数据的首地址的值为 4 或 8 的整数倍。
    - 基本类型数据对齐是指数据在内存中的偏移地址必须为一个字的整数倍，这种存储数据的方式，可以提升系统在读取数据时的性能。结构体数据对齐，是指在结构体中的上一个数据域结束和下一个数据域开始的地方填充一些无用的字节，以保证每个数据域（假定是基本类型数据）都能够对齐（即按基本类型数据对齐）。
    - 对于 RISC-V 处理器而言，load/store 指令进行数据访存时，数据在内存中的地址应该对齐。如果访存 32 位数据，内存地址应当按 32 位（4字节）对齐。如果数据的地址没有对齐，执行访存操作将产生异常。这也是在学习内核编程中经常碰到的一种 bug。
