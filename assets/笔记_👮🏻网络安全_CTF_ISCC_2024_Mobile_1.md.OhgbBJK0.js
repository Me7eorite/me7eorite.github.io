import{_ as l,c as e,J as s,V as p,m as i,a as h,o as k,E as a}from"./chunks/framework.WH0rnJL5.js";const r="/assets/image-20240503011204183.cm0sMHsr.png",d="/assets/image-20240503011053127.2pArI9Hq.png",c="/assets/image-20240503011347998.ANtwdV2s.png",o="/assets/image-20240503011528435.4M7px3HI.png",u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"笔记/👮🏻网络安全/CTF/ISCC/2024/Mobile_1.md","filePath":"笔记/👮🏻网络安全/CTF/ISCC/2024/Mobile_1.md"}'),g={name:"笔记/👮🏻网络安全/CTF/ISCC/2024/Mobile_1.md"},y=p(`<h2 id="mobile-1" tabindex="-1">Mobile_1 <a class="header-anchor" href="#mobile-1" aria-label="Permalink to &quot;Mobile_1&quot;">​</a></h2><p>首先安装以下两个库</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>pip install frida</span></span>
<span class="line"><span>pip install frida-server</span></span></code></pre></div><p>再安装雷电模拟器，安装成功之后。修改模拟器权限增加ROOT。</p><p><img src="`+r+'" alt="image-20240503011204183"></p><p>进入雷电模拟器的目录<code>xxx\\leidian\\LDPlayer9</code>,在该目录下打开cmd，执行如下命令判断adb是否可以使用。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>adb devices</span></span></code></pre></div><p><img src="'+d+`" alt="image-20240503011053127"></p><p>然后将<code>frida-server</code>移动到<code>adb push frida-server-16.2.1 /data/local/tmp</code>目录下.</p><p>执行以下命令：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>adb shell</span></span>
<span class="line"><span>su</span></span>
<span class="line"><span>cd /data/local/tmp</span></span>
<span class="line"><span>./frida-server-16.2.1 &amp;</span></span></code></pre></div><p>在之后利用雷电模拟器安装apk，apk就是题目提供的附件</p><p><img src="`+c+`" alt="image-20240503011347998"></p><p>安装成功之后打开，首先执行以下python脚本</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> frida,sys</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#D19A66;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#D19A66;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">dada</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> message[</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;send&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;[*] </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">{0}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(message[</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;payload&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(message)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#hook js</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">jscode </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    Java.perform(function(){</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        var targetClass = Java.use(&#39;com.example.whathappened.a&#39;);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        var Receiver = Java.use(&#39;com.example.whathappened.Receiver&#39;);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        targetClass.a.implementation = function() {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            console.log(&#39;hack&#39;);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            var s = &quot;04999999&quot;;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            var s1 = &quot;gwC9nOCNUhsHqZm&quot;;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            var enc = Receiver.encrypt2(Receiver.encrypt(s, s1)).substring(0, 0x20);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            console.log(enc);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    });</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># jscode = &#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">NolebasePageProperties </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#     Java.perform(function(){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#         var targetClass = Java.use(&#39;com.example.whathappened.a&#39;);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#         var Myjni = Java.use(&#39;com.example.whathappened.MyJNI.Myjni&#39;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#         targetClass.a.implementation = function() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#             console.log(&#39;hack&#39;);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#             var leak = Myjni.getstr();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#             console.log(leak);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#             return true;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#         }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#     });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># &#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 启动方式1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">process </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> frida.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">get_usb_device</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">attach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Puzzle Game&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">script </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> process.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">create_script</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(jscode)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">script.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, on_message)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">script.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">load</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">sys.stdin.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># # 启动方式2 spawn 重启APP 可以hook APP启动阶段</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># device = frida.get_usb_device(-1)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># pid = device.spawn([&#39;3200&#39;])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># process = device.attach(pid)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># script = process.create_script(test)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># script.on(&#39;message&#39;, on_message)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># script.load()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># device.resume(pid)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># sys.stdin.read()</span></span></code></pre></div><p>在打开的apk中，输入以下内容：</p><p><img src="`+o+'" alt="image-20240503011528435"></p><p>点击check，之后查看python脚本的回显就行。</p><h2 id="贡献者" tabindex="-1">贡献者 <a class="header-anchor" href="#贡献者" aria-label="Permalink to &quot;贡献者&quot;">​</a></h2>',19),B=i("h2",{id:"文件历史",tabindex:"-1"},[h("文件历史 "),i("a",{class:"header-anchor",href:"#文件历史","aria-label":'Permalink to "文件历史"'},"​")],-1);function F(A,f,C,m,E,_){const n=a("NolebaseGitContributors"),t=a("NolebaseGitChangelog");return k(),e("div",null,[y,s(n),B,s(t)])}const D=l(g,[["render",F]]);export{u as __pageData,D as default};
